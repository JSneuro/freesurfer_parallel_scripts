### Some notes on FreeSurfer and MacOS

If using MacOS, you need to make sure that you have a version that can actually run FreeSurfer. Over time, Apple has limited more and more what programs can be run under MacOS and the latest versions are not supported by FreeSurfer yet. Some things to keep in mind are:

* Support for 32 bit binaries (x86 compatibility mode on the am64 architecture) was dropped in MacOS Catalina, and some older FreeSurfer tools are 32 bit (e.g., `tkmedit`). They do not work under MacOS versions >= Catalina. None of the `recon-all` tools are 32 bit-only though, afaik, so it should work to run FreeSurfer pre-processing under Catalina.
* The system integrity protection (SIP) may need to be turned off in order for some FreeSurfer programs to run properly. It was introduced in El Capitan. See the [FreeSurfer release notes](https://surfer.nmr.mgh.harvard.edu/fswiki/ReleaseNotes), search the page for 'lazy symbol binding'.
* The default shell on newer MacOS versions >= Catalina is no longer bash. This is fine, but you must make sure that FreeSurfer is configured properly for bash, no matter what your default shell is. Note: You do NOT need to change your default shell to bash to use FreeSurfer or these scripts.
* Only the amd64 architecture is supported by FreeSurfer, so ARM hardware ("Apple Silicon" Macs) will not work.
* Recent MacOS versions starting from Big Sur do not allow any software to be run for which the developers of the software did not sign up with Apple, accepted various terms and conditions, and signed the software distribution with a certificate they obtained from Apple. This means that various software cannot be run on such systems. The system has lots of holes though, and it seems that while one cannot run arbitrary binaries, one can run arbitrary programs as long as they are scripts (which are run on an interpreter that has been registered). This means that it may still be possible to run parts of the FreeSurfer tools, but we did not try it and we recommend not to use recent MacOS versions for scientific computing.
* The bash and python versions that come with MacOS are very old, and it can save one a lot of trouble to install new versions (e.g., bash from homebrew or macports and python from anaconda). This is not required though.

That being said, we use FreeSurfer under older MacOS versions on amd64 hardware and it works perfectly. We have a dedicated iMac with 24 cores running MacOS High Sierra for this task, on which we do not update the OS.
